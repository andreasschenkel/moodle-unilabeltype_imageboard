define("unilabeltype_imageboard/imageboardpreviewrenderer",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=()=>{setTimeout(refreshBackgroundImage,3e3),setTimeout((function(){let backgroundfileNode=document.getElementById("id_unilabeltype_imageboard_backgroundimage_fieldset");if(backgroundfileNode){new MutationObserver(refreshBackgroundImage).observe(backgroundfileNode,{attributes:!0,childList:!0,subtree:!0})}let canvasx=document.getElementById("id_unilabeltype_imageboard_canvaswidth");if(canvasx){new MutationObserver(refreshBackgroundImage).observe(canvasx,{attributes:!0,childList:!0,subtree:!0})}let canvasy=document.getElementById("id_unilabeltype_imageboard_canvasheight");if(canvasy){new MutationObserver(refreshBackgroundImage).observe(canvasy,{attributes:!0,childList:!0,subtree:!0})}document.querySelectorAll('[id^="button-mform1"]')[0].addEventListener("click",(function(){setTimeout((function(){addImageToDom(document.querySelectorAll('[id^="fitem_id_unilabeltype_imageboard_title_"]').length-1),setTimeout((function(){registerAllListenersForAllElements()}),1e3)}),1e3)})),setTimeout((function(){registerAllListenersForAllElements()}),1e3)}),4e3),setTimeout(refreshAllImages,5e3);var activeItem=null,activeNumber=null,itemToMove=null,canvas=null;function dragStart(event){if(event.target.classList.contains("image")){event.preventDefault(),activeItem=event.target,activeNumber=event.target.getAttribute("id").split("unilabel-imageboard-imageid_")[1],itemToMove=document.getElementById("unilabel_imageboard_imagediv_"+activeNumber);var position=canvas.getBoundingClientRect(),offsetLeft=position.left,offsetTop=position.top;activeItem&&(itemToMove.style.left=Math.round(event.clientX-offsetLeft)+"px",itemToMove.style.top=Math.round(event.clientY-offsetTop)+"px")}}function drag(event){if(activeItem){var position=canvas.getBoundingClientRect(),offsetLeft=position.left,offsetTop=position.top;itemToMove.style.left=Math.round(event.clientX-offsetLeft)+"px",itemToMove.style.top=Math.round(event.clientY-offsetTop)+"px";const input_xposition=document.getElementById("id_unilabeltype_imageboard_xposition_"+activeNumber),input_yposition=document.getElementById("id_unilabeltype_imageboard_yposition_"+activeNumber);input_xposition.value=Math.round(event.clientX-offsetLeft),input_yposition.value=Math.round(event.clientY-offsetTop)}}function dragEnd(event){if(activeItem){var position=canvas.getBoundingClientRect(),offsetLeft=position.left,offsetTop=position.top;itemToMove.style.left=Math.round(event.clientX-offsetLeft)+"px",itemToMove.style.top=Math.round(event.clientY-offsetTop)+"px";const input_xposition=document.getElementById("id_unilabeltype_imageboard_xposition_"+activeNumber),input_yposition=document.getElementById("id_unilabeltype_imageboard_yposition_"+activeNumber);input_xposition.value=Math.round(event.clientX-offsetLeft),input_yposition.value=Math.round(event.clientY-offsetTop),activeItem=null,activeNumber=null}}function registerAllListenersForAllElements(){const singleElements=document.querySelectorAll('[id^="fitem_id_unilabeltype_imageboard_title_"]');for(let i=0;i<singleElements.length;i++){registerAllListenersForSingleElement(singleElements[i].getAttribute("id").split("fitem_id_unilabeltype_imageboard_title_")[1])}}function registerAllListenersForSingleElement(number){document.getElementById("id_unilabeltype_imageboard_title_"+number).addEventListener("focusout",(function(){refreshImage(number)}));document.getElementById("id_unilabeltype_imageboard_xposition_"+number).addEventListener("focusout",(function(){refreshImage(number)}));document.getElementById("id_unilabeltype_imageboard_yposition_"+number).addEventListener("focusout",(function(){refreshImage(number)}));document.getElementById("id_unilabeltype_imageboard_targetwidth_"+number).addEventListener("focusout",(function(){refreshImage(number)}));document.getElementById("id_unilabeltype_imageboard_targetheight_"+number).addEventListener("focusout",(function(){refreshImage(number)}));document.getElementById("id_unilabeltype_imageboard_border_"+number).addEventListener("focusout",(function(){refreshImage(number)}));let imagefileNode=document.getElementById("fitem_id_unilabeltype_imageboard_image_"+number);if(imagefileNode){new MutationObserver(refreshImage).observe(imagefileNode,{attributes:!0,childList:!0,subtree:!0})}}function refreshBackgroundImage(){let previewimage=document.getElementById("id_unilabeltype_imageboard_backgroundimage_fieldset").getElementsByClassName("realpreview"),backgrounddiv=document.getElementById("unilabel-imageboard-background-area");if(previewimage.length>0){let backgroundurl=previewimage[0].getAttribute("src").split("?")[0];previewimage[0].getAttribute("src").split("?")[1].includes("&oid=")&&(backgroundurl+="?oid="+previewimage[0].getAttribute("src").split("&oid=")[1]),backgrounddiv.style.background="red",backgrounddiv.style.backgroundSize="cover",backgrounddiv.style.backgroundImage="url('"+backgroundurl+"')";let canvaswidth=document.getElementById("id_unilabeltype_imageboard_canvaswidth").selectedOptions[0].value;backgrounddiv.style.width=canvaswidth+"px";let canvasheight=document.getElementById("id_unilabeltype_imageboard_canvasheight").selectedOptions[0].value;backgrounddiv.style.height=canvasheight+"px"}else{backgrounddiv.style.background="green",backgrounddiv.style.backgroundImage="url('')";let canvaswidth=document.getElementById("id_unilabeltype_imageboard_canvaswidth").selectedOptions[0].value;backgrounddiv.style.width=canvaswidth+"px";let canvasheight=document.getElementById("id_unilabeltype_imageboard_canvasheight").selectedOptions[0].value;backgrounddiv.style.height=canvasheight+"px"}}function refreshAllImages(){const singleElements=document.querySelectorAll('[id^="fitem_id_unilabeltype_imageboard_image_"]');for(let i=0;i<singleElements.length;i++){let number=singleElements[i].getAttribute("id").split("fitem_id_unilabeltype_imageboard_image_")[1];null===document.getElementById("unilabel-imageboard-imageid_"+number)?(addImageToDom(number),refreshImage(number)):refreshImage(number)}}function addImageToDom(number){let backgroundArea=document.getElementById("unilabel-imageboard-background-area");null===document.getElementById("unilabel-imageboard-imageid_"+number)?(backgroundArea.innerHTML=backgroundArea.innerHTML+function(number){return"<div id='unilabel_imageboard_imagediv_"+number+"' style='z-index: 5; position: absolute;'><div id='imageidtitle_"+number+"' class='unilabel-imageboard-title rounded'  style='position: relative;'>Ãœberschrift</div><div id='imageidimage_"+number+"'><img class='image' src='' id='unilabel-imageboard-imageid_"+number+"' style='position: relative;'></div></div>"}(number),refreshImage(number)):refreshImage(number)}function refreshImage(number){if(Array.isArray(number))setTimeout((function(){registerAllListenersForAllElements()}),300),setTimeout((function(){refreshAllImages()}),600);else{let imageid=document.getElementById("unilabel-imageboard-imageid_"+number),imagedata=function(number){let imageids={title:"id_unilabeltype_imageboard_title_"+number,xposition:"id_unilabeltype_imageboard_xposition_"+number,yposition:"id_unilabeltype_imageboard_yposition_"+number,targetwidth:"id_unilabeltype_imageboard_targetwidth_"+number,targetheight:"id_unilabeltype_imageboard_targetheight_"+number,src:"",border:"id_unilabeltype_imageboard_border_"+number},imagedata=[];imagedata.title=document.getElementById(imageids.title).value,imagedata.xposition=document.getElementById(imageids.xposition).value,imagedata.yposition=document.getElementById(imageids.yposition).value,imagedata.targetwidth=document.getElementById(imageids.targetwidth).value,imagedata.targetheight=document.getElementById(imageids.targetheight).value;const imagetag=document.getElementById("id_unilabeltype_imageboard_image_"+number+"_fieldset").getElementsByTagName("img");let src="";imagetag.length&&0!=imagetag.length&&(src=imagetag[0].src,src=src.split("?")[0]);return imagedata.src=src,imagedata.border=document.getElementById(imageids.border).value,imagedata}(number);imageid.style.background="blue",imageid.src=imagedata.src;const imagediv=document.getElementById("unilabel_imageboard_imagediv_"+number);imagediv.style.left=parseInt(imagedata.xposition)+"px",imagediv.style.top=parseInt(imagedata.yposition)+"px",0!=imagedata.targetwidth?imageid.style.width=imagedata.targetwidth+"px":imageid.style.width="auto",0!=imagedata.targetheight?imageid.style.height=imagedata.targetheight+"px":imageid.style.height="auto",""!=imagedata.title?imageid.title=imagedata.title:imageid.title="";let colourpicker=document.getElementById("id_unilabeltype_imageboard_titlebackgroundcolor_colourpicker"),color="";color=""==colourpicker.value?"#000000":colourpicker.value,0!=imagedata.border?(imageid.style.border=imagedata.border+"px solid",imageid.style.borderColor=color):imageid.style.border="0";let title=imagedata.title;document.getElementById("imageidtitle_"+number).innerHTML=title}}setTimeout((function(){(canvas=document.getElementById("unilabel-imageboard-background-area")).addEventListener("mousedown",dragStart,!1),canvas.addEventListener("mousemove",drag,!1),canvas.addEventListener("mouseup",dragEnd,!1)}),1e3)}}));

//# sourceMappingURL=imageboardpreviewrenderer.min.js.map